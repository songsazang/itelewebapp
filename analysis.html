<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>나만의 교육과정 분석</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
        .subject-card {
            background-color: #eff6ff;
            border-left: 5px solid #3b82f6;
        }
        body {
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            overflow: hidden;
        }
        .scrollable {
            overflow-y: auto;
            height: 100vh;
            scroll-behavior: smooth;
        }
        .click-effect {
            position: fixed;
            pointer-events: none;
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(255,255,255,0.8) 0%, rgba(255,255,255,0) 70%);
            transform: translate(-50%, -50%);
            animation: clickAnimation 0.3s ease-out forwards;
            z-index: 9999;
        }
        @keyframes clickAnimation {
            0% {
                transform: translate(-50%, -50%) scale(0);
                opacity: 0.8;
            }
            100% {
                transform: translate(-50%, -50%) scale(1);
                opacity: 0;
            }
        }
    </style>
</head>
<body class="bg-gray-50">
    <div class="scrollable">
        <main class="p-4 sm:p-8 max-w-4xl mx-auto min-h-screen">
            <div class="text-center py-8">
                <h1 class="text-4xl font-bold text-gray-800">나만의 교육과정 분석</h1>
                <p class="text-lg text-gray-600 mt-2">선택하신 10개의 교과목입니다.</p>
            </div>

            <div id="analysis-result" class="mt-8 space-y-8">
                <!-- 결과가 여기에 동적으로 추가됩니다 -->
            </div>

            <div id="related-info" class="mt-12">
                <h2 class="text-2xl font-bold text-gray-700 mb-6">연관 정보</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="bg-white p-6 rounded-lg shadow">
                        <h3 class="text-xl font-semibold text-blue-700 mb-4">관련 자격증</h3>
                        <div id="certificates" class="space-y-2"></div>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow">
                        <h3 class="text-xl font-semibold text-blue-700 mb-4">관련 직업</h3>
                        <div id="jobs" class="space-y-2"></div>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow">
                        <h3 class="text-xl font-semibold text-blue-700 mb-4">관련 학과</h3>
                        <div id="departments" class="space-y-2"></div>
                    </div>
                </div>
            </div>

            <div class="mt-12 flex flex-col sm:flex-row justify-center gap-4">
                <a href="my-curriculum.html" class="w-full sm:w-auto inline-block bg-blue-600 text-white text-center px-8 py-3 rounded-lg hover:bg-blue-700 transition-colors">
                    다시 만들기
                </a>
                <a href="index.html" class="w-full sm:w-auto inline-block bg-gray-600 text-white text-center px-8 py-3 rounded-lg hover:bg-gray-700 transition-colors">
                    메인으로 돌아가기
                </a>
            </div>
        </main>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        const params = new URLSearchParams(window.location.search);
        const encodedData = params.get('data');
        const analysisResultContainer = document.getElementById('analysis-result');
        let finalCsvData = null;

        // CSV 파일 로드
        fetch('select_final_last.csv')
            .then(response => response.text())
            .then(data => {
                console.log('CSV 파일 로드 성공');
                console.log('select_final_last.csv 내용:', data);

                const rows = data.split('\n').filter(row => row.trim() !== '');
                finalCsvData = rows.map(row => {
                    const columns = row.split(',').map(col => col.trim());
                    if (columns.length >= 4) {
                        return {
                            subjects: columns[0].split(',').map(s => s.trim()),
                            certificates: columns[1].split(',').map(s => s.trim()),
                            jobs: columns[2].split(',').map(s => s.trim()),
                            departments: columns[3].split(',').map(s => s.trim())
                        };
                    }
                    return null;
                }).filter(item => item !== null);

                console.log('파싱된 finalCsvData:', finalCsvData);
            })
            .catch(error => {
                console.error('CSV 파일 로드 실패:', error);
            });

        if (encodedData) {
            try {
                const decodedData = decodeURIComponent(encodedData);
                const selectedSubjects = JSON.parse(decodedData);
                
                // 코스명 추출 및 표시
                const courseNames = new Set();
                Object.values(selectedSubjects).forEach(subjects => {
                    subjects.forEach(subjectInfo => {
                        if (subjectInfo.course) {
                            courseNames.add(subjectInfo.course);
                        }
                    });
                });
                if (courseNames.size > 0) {
                    const courseTitle = document.createElement('div');
                    courseTitle.className = 'text-center text-2xl font-semibold text-blue-700 mb-8';
                    courseTitle.textContent = `선택한 전공 코스: ${Array.from(courseNames).join(', ')}`;
                    analysisResultContainer.parentNode.insertBefore(courseTitle, analysisResultContainer);
                }

                Object.entries(selectedSubjects).forEach(([grade, subjects]) => {
                    if (subjects.length > 0) {
                        const gradeSection = document.createElement('div');
                        
                        const gradeTitle = document.createElement('h2');
                        gradeTitle.className = 'text-2xl font-bold text-gray-700 mb-4';
                        gradeTitle.textContent = grade;
                        gradeSection.appendChild(gradeTitle);

                        const grid = document.createElement('div');
                        grid.className = 'grid grid-cols-1 md:grid-cols-2 gap-4';
                        
                        subjects.forEach(subjectInfo => {
                            const subjectDiv = document.createElement('div');
                            subjectDiv.className = 'subject-card p-4 rounded-lg shadow';
                            
                            let typeText = '';
                            if (subjectInfo.courseType) {
                                typeText = subjectInfo.courseType.replace(/학년 /g, '');
                            } else if (subjectInfo.course) {
                                typeText = '전공코스';
                            }

                            subjectDiv.innerHTML = `
                                <p class="font-semibold text-lg text-blue-800">${subjectInfo.subject}</p>
                                <p class="text-sm text-gray-600">${typeText}</p>
                            `;
                            grid.appendChild(subjectDiv);
                        });

                        gradeSection.appendChild(grid);
                        analysisResultContainer.appendChild(gradeSection);
                    }
                });

                // 연관 정보 표시
                const certificates = new Set();
                const jobs = new Set();
                const departments = new Set();

                // select_final_last.csv에서 일치하는 행 찾기
                if (finalCsvData) {
                    const selectedSubjectsList = [];
                    Object.values(selectedSubjects).forEach(subjects => {
                        subjects.forEach(subjectInfo => {
                            selectedSubjectsList.push(subjectInfo.subject);
                        });
                    });
                    console.log('선택된 교과목 목록:', selectedSubjectsList);

                    // 모든 교과목이 일치하는 행 찾기
                    const matchingRow = finalCsvData.find(row => {
                        const allSubjects = row.subjects;
                        const selectedCount = selectedSubjectsList.filter(selectedSubject => 
                            allSubjects.some(subject => subject.includes(selectedSubject))
                        ).length;
                        return selectedCount === 10;
                    });

                    if (matchingRow) {
                        // 자격증, 직업, 학과 정보 추가
                        matchingRow.certificates.forEach(cert => {
                            if (cert) certificates.add(cert);
                        });
                        matchingRow.jobs.forEach(job => {
                            if (job) jobs.add(job);
                        });
                        matchingRow.departments.forEach(dept => {
                            if (dept) departments.add(dept);
                        });
                    } else {
                        console.log('일치하는 행을 찾을 수 없습니다.');
                        // 일치하는 행이 없을 경우 연관 정보 섹션 숨기기
                        document.getElementById('related-info').style.display = 'none';
                    }
                }

                console.log('최종 자격증:', Array.from(certificates));
                console.log('최종 직업:', Array.from(jobs));
                console.log('최종 학과:', Array.from(departments));

                // 연관 정보를 HTML에 추가
                const certificatesContainer = document.getElementById('certificates');
                const jobsContainer = document.getElementById('jobs');
                const departmentsContainer = document.getElementById('departments');

                certificates.forEach(cert => {
                    const p = document.createElement('p');
                    p.className = 'text-gray-700';
                    p.textContent = cert;
                    certificatesContainer.appendChild(p);
                });

                jobs.forEach(job => {
                    const p = document.createElement('p');
                    p.className = 'text-gray-700';
                    p.textContent = job;
                    jobsContainer.appendChild(p);
                });

                departments.forEach(dept => {
                    const p = document.createElement('p');
                    p.className = 'text-gray-700';
                    p.textContent = dept;
                    departmentsContainer.appendChild(p);
                });

            } catch (error) {
                analysisResultContainer.innerHTML = '<p class="text-center text-red-500">교육과정 정보를 불러오는 데 실패했습니다.</p>';
                console.error('Error parsing subject data:', error);
            }
        } else {
            analysisResultContainer.innerHTML = '<p class="text-center text-gray-500">선택된 교육과정 정보가 없습니다. 교육과정을 먼저 만들어주세요.</p>';
        }

        // 클릭 효과 추가
        document.addEventListener('click', function(e) {
            const effect = document.createElement('div');
            effect.className = 'click-effect';
            effect.style.left = e.pageX + 'px';
            effect.style.top = e.pageY + 'px';
            document.body.appendChild(effect);

            // 애니메이션 종료 후 요소 제거
            effect.addEventListener('animationend', function() {
                effect.remove();
            });
        });

        // 스크롤 관련 기능 추가
        let isScrolling = false;
        let startY;
        let scrollTop;

        document.querySelector('.scrollable').addEventListener('mousedown', function(e) {
            isScrolling = true;
            startY = e.pageY - this.offsetTop;
            scrollTop = this.scrollTop;
        });

        document.addEventListener('mousemove', function(e) {
            if (!isScrolling) return;
            e.preventDefault();
            const y = e.pageY - document.querySelector('.scrollable').offsetTop;
            const walk = (y - startY) * 2;
            document.querySelector('.scrollable').scrollTop = scrollTop - walk;
        });

        document.addEventListener('mouseup', function() {
            isScrolling = false;
        });

        document.addEventListener('mouseleave', function() {
            isScrolling = false;
        });
    });
    </script>
</body>
</html> 
